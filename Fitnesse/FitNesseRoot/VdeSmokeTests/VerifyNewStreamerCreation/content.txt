!style_blue{'''Verify whether streamer can be created and deployed successfully'''}
 

!style_blue{'''Import package - common to all wiki pages'''}.

|Import                     |
|com.comcast.core.VDEutility|
|com.comcast.vde.cm.impl         |
|com.comcast.core           |
|com.comcast.vde.cm.helper           |
|com.comcast.vde.cm.model           |
     
!style_blue{'''Login into CM API'''}

!| VDECMAPIImpl|
|=loginVDE()   |
|strToken      |

!style_blue{'''create configuration of streamer'''}

!| VDECMHelper                                |
|token=  |fileName         |=createDataJSON()   |
|strToken|C:\Users\snair02c\workspace\VDE-Fitnesse\VdeFixtures\create_streamer_data.txt|strStreamerConfig|

!style_blue{'''Create a streamer from streamer config'''}

!| VDECMAPIImpl                                                                        |
|token=  |streamerConfig=  |=createStreamer()       |
|strToken|strStreamerConfig|strCreatedStreamerConfig|

!style_blue{'''Deploy the created streamer'''}

!| VDECMAPIImpl                                     |
|token=  |streamerConfig=         |=deployStreamer()|
|strToken|strCreatedStreamerConfig|streamerID       |


!style_blue{'''Adding 10 second delay'''}

!|AddDelay                  |
|time|delay?                |
|10  |delayed for 10 seconds|

!style_blue{'''Login into Master Node'''}

!|RunCommand                                    |
|host         |username   |password   |connect? |
|${masterNode}|${username}|${password}|connected|


!style_blue{'''Retrieve all the PODs with Running Status, Ready 2/2 and Restart count 0'''}

!|RunCommand                                                                                                                           |
|command                                                                                                                     |=output()|
|echo Pr3r00t !-|-! su -c "kubectl get pods -o wide !-|-! grep Running !-|-! grep 2/2" root !-|-! awk '{ if($4==0) print $0}'|podOutput|


!style_blue{'''Verify whether pod created in available in the node'''}

!|SearchString                       |
|input=   |searchtext=|performsearch?|
|podOutput|streamerID |Found         |

!style_blue{'''Verify whether corresponding stream is created'''}

!|RunCommand                                               |
|command                                      |=output()   |
|echo Pr3r00t !-|-! su -c "kubectl get stream"|streamOutput|


!style_blue{'''Verify whether pod created in available in the node'''}

!|SearchString                          |
|input=      |searchtext=|performsearch?|
|streamOutput|streamerID |Found         |

!style_blue{'''Get the pod details'''}

!| SearchString                                          |
|input=   |searchtext=|performsearch?|=getMatchingLines()|
|podOutput|streamerID |              |podDetails         |

!style_blue{'''Extract the pod ID'''}

!|ConcatenateString                                             |
|string1|string2=  |string3       |string4|=ConcatenatedString()|
|echo ' |podDetails|' !-|-! cut -d|' ' -f1|extractPodId         |

!| RunCommand         |
|command=    |=output?|
|extractPodId|podId   |

!style_blue{'''Enter the Pod '''}

!|ConcatenateString                                                                                           |
|string1     |string2                         |string3=|string4                         |=ConcatenatedString()|
|echo Pr3r00t|!-|-! su -c "kubectl exec !-/s-!|podId   |!-/s-! -c vde-streamer -it bash" ; am -0 show out|execPod              |

!| RunCommand     |
|command=|output()|
|execPod |        |

!style_blue{'''Verify whether the streamer is streaming using the am command '''}

!| RunCommand          |
|command       |output()|
|am -0 show out|       |


!style_blue{'''Exit the master node'''}

!|RunCommand    |
|command|output?|
|exit   |       |


