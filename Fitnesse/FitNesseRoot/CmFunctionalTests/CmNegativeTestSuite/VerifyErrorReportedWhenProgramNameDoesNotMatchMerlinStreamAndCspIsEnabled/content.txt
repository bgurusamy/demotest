!style_blue{'''Verify if the programName value does not match the Merlin Linear Stream value and the cspEnable field is set to enable, the platform MUST log the error'''}
 

!style_blue{'''Import package - common to all wiki pages'''}.

|Import                     |
|com.comcast.core.VDEutility|
|com.comcast.vde.cm.impl    |
|com.comcast.core           |
|com.comcast.vde.cm.helper  |
|com.comcast.vde.cm.model   |
     
!style_blue{'''Login into CM API'''}

!| VDECMAPIImpl|
|=loginVDE()   |
|strToken      |

!style_blue{'''create configuration of streamer'''}

!| VDECMHelper                                              |
|token=  |fileName                        |=createDataJSON()|
|strToken|../VdeFixtures/streamer_data.txt|strStreamerConfig|

!style_blue{'''Create a streamer from streamer config'''}

!| VDECMAPIImpl                                     |
|token=  |streamerConfig=  |=createStreamer()       |
|strToken|strStreamerConfig|strCreatedStreamerConfig|

!style_blue{'''Deploy the created streamer'''}

!| VDECMAPIImpl                                     |
|token=  |streamerConfig=         |=deployStreamer()|
|strToken|strCreatedStreamerConfig|streamerID       |


!style_blue{'''Adding 10 second delay'''}

!|AddDelay                  |
|time|delay?                |
|10  |delayed for 10 seconds|

!style_blue{'''Get the configuration of existing streamer'''}

!| VDECMAPIImpl                        |
|token=  |streamerID=|=getStreamer()   |
|strToken|streamerID |strStreamerConfig|

!style_blue{'''Validate mux config with provided param and value '''}

!|VDECMAPIImpl                                                                                                              |
|muxConfigUpdatePath|muxConfigUpdateParam|muxConfigUpdateParamValue|token=  |streamerConfig=  |ValidateAndUpdateMUXConfig()?|
|program/0/input    |cspEnable           |true                     |strToken|strStreamerConfig|                             |


!style_blue{'''Get the configuration of existing streamer'''}

!| VDECMAPIImpl                        |
|token=  |streamerID=|=getStreamer()   |
|strToken|streamerID |strStreamerConfig|

!style_blue{'''check mux config to see if value got updated'''}

!|VDECMAPIImpl                                                                                                             |
|muxConfigUpdatePath|muxConfigUpdateParam|muxConfigUpdateParamValue|token=  |streamerConfig=  |checkMUXConfigFortheValue()?|
|program/0/input    |cspEnable           |true                     |strToken|strStreamerConfig|Found                       |

!style_blue{'''Validate mux config with provided param and value '''}

!|VDECMAPIImpl                                                                                                              |
|muxConfigUpdatePath|muxConfigUpdateParam|muxConfigUpdateParamValue|token=  |streamerConfig=  |ValidateAndUpdateMUXConfig()?|
|program/5/input    |cspEnable           |true                     |strToken|strStreamerConfig|                             |

!style_blue{'''Get the configuration of existing streamer'''}

!| VDECMAPIImpl                        |
|token=  |streamerID=|=getStreamer()   |
|strToken|streamerID |strStreamerConfig|

!style_blue{'''Validate mux config with provided param and value '''}

!|VDECMAPIImpl                                                                                                              |
|muxConfigUpdatePath|muxConfigUpdateParam|muxConfigUpdateParamValue|token=  |streamerConfig=  |ValidateAndUpdateMUXConfig()?|
|program/0          |programName         |test                     |strToken|strStreamerConfig|                             |

!style_blue{'''Get the configuration of existing streamer'''}

!| VDECMAPIImpl                        |
|token=  |streamerID=|=getStreamer()   |
|strToken|streamerID |strStreamerConfig|

!style_blue{'''check mux config to see if value got updated'''}

!|VDECMAPIImpl                                                                                                             |
|muxConfigUpdatePath|muxConfigUpdateParam|muxConfigUpdateParamValue|token=  |streamerConfig=  |checkMUXConfigFortheValue()?|
|program/0          |programName         |test                     |strToken|strStreamerConfig|Found                       |

!style_blue{'''Login into Master Node'''}

!|RunCommand                                    |
|host         |username   |password   |connect? |
|${masterNode}|${username}|${password}|connected|

!style_blue{'''Adding 20 second delay'''}

!|AddDelay                  |
|time|delay?                |
|20  |delayed for 20 seconds|

!style_blue{'''Retrieve all the PODs with Running Status, Ready 2/2 and Restart count 0'''}

!|RunCommand                                                                                                                           |
|command                                                                                                                     |=output()|
|echo Pr3r00t !-|-! su -c "kubectl get pods -o wide !-|-! grep Running !-|-! grep 2/2" root !-|-! awk '{ if($4==0) print $0}'|podOutput|

!style_blue{'''Get the pod details'''}

!| SearchString                                          |
|input=   |searchtext=|performsearch?|=getMatchingLines()|
|podOutput|streamerID |              |podDetails         |

!style_blue{'''Extract the pod ID'''}

!|ConcatenateString                                             |
|string1|string2=  |string3       |string4|=ConcatenatedString()|
|echo ' |podDetails|' !-|-! cut -d|' ' -f1|extractPodId         |

!| RunCommand         |
|command=    |=output?|
|extractPodId|podId   |

!style_blue{'''Get the Pod logs'''}

!|ConcatenateString                                                                                                                                                                            |
|string1     |string2                        |string3=|string4                                                                                                           |=ConcatenatedString()|
|echo Pr3r00t|!-|-! su -c "kubectl log !-/s-!|podId   |!-/s-! -c vde-streamer --timestamps  !-|-! grep 'streamer-0: Program 0 ERROR: ProgramName mismatch. ProgramName' "|getPodLogs              |

!| RunCommand     |
|command=|=output()|
|getPodLogs |  podLogs      |

!style_blue{'''Search for the error message'''}

!|SearchString                                                                                                            |
|input=     |searchtext                                                                                    |performsearch?|
|podLogs|streamer-0: Program 0 ERROR: ProgramName mismatch. ProgramName=test Merlin Linear Stream name=|Found         |

